{% extends "base.html" %}
{% load static %}

{% block content %}

<section class="collab-hero py-5">
    <div class="container">
        <div class="row align-items-center g-4">
            <div class="col-lg-7">
                <h1 class="section-title display-6 fw-bold mb-3">همکاری با عباس لطفی نسب</h1>
                <p class="section-subtitle mb-4">
                    در صورتی که نیاز به توسعه‌دهنده‌ای برای تقویت تیم فنی دارید یا به دنبال برون‌سپاری پروژه‌ای هستید،
                    خوشحال می‌شوم همکاری مؤثری با شما داشته باشم
                </p>
                <div class="d-flex flex-wrap gap-2">
                    <a href="#project-form" class="btn btn-primary btn-lg rounded-3 px-4">برون‌سپاری پروژه</a>
                    <a href="#hire-form" class="btn btn-outline-primary btn-lg rounded-3 px-4">درخواست همکاری</a>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="hero-card p-4 p-md-5 rounded-4 shadow-sm bg-white border">
                    <ul class="list-unstyled small m-0">
                        <li class="d-flex align-items-center mb-3"><i
                                class="fa-regular fa-circle-check ms-2 text-primary"></i> یک نفر، چرخهٔ کامل: موبایل،
                            فرانت و بک
                        </li>
                        <li class="d-flex align-items-center mb-3"><i
                                class="fa-regular fa-circle-check ms-2 text-primary"></i> کد تمیز، معماری قابل‌نگهداری،
                            تحویل مرحله‌ای
                        </li>
                        <li class="d-flex align-items-center"><i
                                class="fa-regular fa-circle-check ms-2 text-primary"></i> تمرکز تا حل مسئله—به‌خصوص
                            چالش‌های سخت
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- چرا با من -->
<section class="collab-hero py-5">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="section-title">چرا با من؟</h2>
            <p class="section-subtitle text-muted">ترکیبی از تجربه، سرعت و هماهنگیِ فنی.</p>
        </div>
        <div class="row g-4">
            <div class="col-12 col-md-4">
                <div class="why-card text-center p-4 rounded-4 shadow-sm bg-white border h-100">
                    <i class="fa-solid fa-layer-group display-6 mb-3 text-primary"></i>
                    <h3 class="h6 fw-bold mb-2">یک‌نفره اما یکپارچه</h3>
                    <p class="text-muted small m-0">موبایل، فرانت و بک در یک مسیر هماهنگ؛ اتلاف کمتر، سرعت بیشتر.</p>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="why-card text-center p-4 rounded-4 shadow-sm bg-white border h-100">
                    <i class="fa-solid fa-gauge-high display-6 mb-3 text-primary"></i>
                    <h3 class="h6 fw-bold mb-2">کیفیت قابل اتکا</h3>
                    <p class="text-muted small m-0">کد تمیز، تست‌پذیر و مستند؛ تحویل‌های مرحله‌ای و قابل دمو.</p>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="why-card text-center p-4 rounded-4 shadow-sm bg-white border h-100">
                    <i class="fa-solid fa-screwdriver-wrench display-6 mb-3 text-primary"></i>
                    <h3 class="h6 fw-bold mb-2">حل مسئله تا انتها</h3>
                    <p class="text-muted small m-0">روی مسائل سخت می‌مانم تا حل شوند؛ نتیجه‌محور و مسئولیت‌پذیر.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- فرایند همکاری -->
<section class="collab-hero py-5">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="section-title">مراحل همکاری</h2>
        </div>
        <div class="row g-4">
            <div class="col-md-3">
                <div class="step-card p-4 text-center rounded-4 shadow-sm bg-white border h-100">
                    <div class="step-badge">1</div>
                    <h3 class="h6 fw-bold mb-2">جلسه شناخت</h3>
                    <p class="small text-muted m-0">اهداف، قیود، دامنه‌ها (۳۰–۴۵ دقیقه).</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="step-card p-4 text-center rounded-4 shadow-sm bg-white border h-100">
                    <div class="step-badge">2</div>
                    <h3 class="h6 fw-bold mb-2">پیشنهاد فنی/زمانی</h3>
                    <p class="small text-muted m-0">فازبندی، ویژگی‌ها، زمان‌بندی و هزینه.</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="step-card p-4 text-center rounded-4 shadow-sm bg-white border h-100">
                    <div class="step-badge">3</div>
                    <h3 class="h6 fw-bold mb-2">شروع فاز ۱</h3>
                    <p class="small text-muted m-0">ریپو، CI/CD، محیط تست و اولین دمو.</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="step-card p-4 text-center rounded-4 shadow-sm bg-white border h-100">
                    <div class="step-badge">4</div>
                    <h3 class="h6 fw-bold mb-2">تحویل و پایش</h3>
                    <p class="small text-muted m-0">استقرار، مانیتورینگ، آموزش و نگهداری.</p>
                </div>
            </div>
        </div>
        <div class="text-center small text-muted mt-3">زمان پاسخ‌دهی: حداکثر ۲۴ ساعت کاری</div>
    </div>
</section>

<!-- مدل‌های همکاری -->
<section class="collab-hero py-5">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="section-title">مدل‌های همکاری</h2>
        </div>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="plan-card p-4 rounded-4 shadow-sm bg-white border h-100">
                    <h3 class="h6 fw-bold mb-2">پروژه ثابت (Fixed)</h3>
                    <p class="text-muted small mb-0">برای محدوده‌های مشخص (MVP/وب‌سایت شرکتی). خروجی قابل استقرار در
                        پایان هر فاز.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="plan-card p-4 rounded-4 shadow-sm bg-white border h-100">
                    <h3 class="h6 fw-bold mb-2">ساعتی/ماهانه (T&M/Retainer)</h3>
                    <p class="text-muted small mb-0">مناسب توسعه تدریجی، نگهداری، یا کنار تیم فعلی شما.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="plan-card p-4 rounded-4 shadow-sm bg-white border h-100">
                    <h3 class="h6 fw-bold mb-2">اسپرینت فشرده</h3>
                    <p class="text-muted small mb-0">تمرکز یک‌ تا دو هفته‌ای بر یک هدف: SEO، Performance، یا فیچر
                        کلیدی.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FAQ کوتاه -->
<section class="collab-hero py-5">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="section-title" style="color:#003c70">سوالات پرتکرار</h2>
        </div>
        <div class="row g-3">
            <div class="col-md-6">
                <div class="faq-item p-3 rounded-4 bg-white border h-100">
                    <strong>از کی می‌تونیم شروع کنیم؟</strong>
                    <p class="text-muted small m-0">معمولاً حداکثر تا یک هفته پس از توافق؛ برای پروژه‌های فوری هماهنگ
                        می‌کنیم.</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="faq-item p-3 rounded-4 bg-white border h-100">
                    <strong>مالکیت کد و داده‌ها با کیست؟</strong>
                    <p class="text-muted small m-0">۱۰۰٪ متعلق به شماست؛ ریپو خصوصی روی سرور شما یا GitLab/GitHub.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- فرم‌ها -->
<section id="forms" class="collab-hero py-5">
    <div class="container">
        <div class="row g-4">
            <!-- فرم پروژه -->
            <div class="col-lg-6">
                <div class="form-card p-4 rounded-4 shadow-sm bg-white border" id="project-form">
                    <h3 class="h5 fw-bold mb-3" style="color:#003c70">ثبت اطلاعات پروژه</h3>
                    <form method="post" action="" novalidate>
                        {% csrf_token %}
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label small">نام شرکت</label>
                                <input name="name" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">ایمیل</label>
                                <input name="email" type="email" class="form-control" required>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label small">شماره تماس</label>
                                <input name="phone" class="form-control" placeholder="مثلاً 09120000000">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label small">نوع پروژه</label>
                                <select name="type" class="form-select">
                                    <option>وب</option>
                                    <option>موبایل</option>
                                    <option>هر دو</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">دامنه کار</label>
                                <div class="d-flex flex-wrap gap-2">
                                    <label class="form-check">
                                        <input class="form-check-input" type="checkbox" name="scope" value="UI/UX">
                                        <span class="form-check-label small">UI/UX</span>
                                    </label>
                                    <label class="form-check">
                                        <input class="form-check-input" type="checkbox" name="scope" value="Front-end">
                                        <span class="form-check-label small">Front-end</span>
                                    </label>
                                    <label class="form-check">
                                        <input class="form-check-input" type="checkbox" name="scope" value="Back-end">
                                        <span class="form-check-label small">Back-end</span>
                                    </label>
                                    <label class="form-check">
                                        <input class="form-check-input" type="checkbox" name="scope" value="CI/CD">
                                        <span class="form-check-label small">CI/CD</span>
                                    </label>
                                    <label class="form-check">
                                        <input class="form-check-input" type="checkbox" name="scope" value="SEO">
                                        <span class="form-check-label small">SEO</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">موعد تقریبی</label>
                                <input name="deadline" type="date" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">بودجه حدودی (اختیاری)</label>
                                <input name="budget" class="form-control" placeholder="مثلاً 200 میلیون">
                            </div>
                            <div class="col-12">
                                <label class="form-label small">توضیح مسئله/هدف</label>
                                <textarea name="message" rows="4" class="form-control" required></textarea>
                            </div>
                            <div class="col-12 d-flex align-items-center gap-2">
                                <input id="nda" type="checkbox" name="nda" class="form-check-input">
                                <label for="nda" class="small m-0">در صورت نیاز NDA امضا می‌شود</label>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary rounded-3 px-4">ارسال درخواست پروژه</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- فرم استخدام -->
            <div class="col-lg-6">
                <div class="form-card p-4 rounded-4 shadow-sm bg-white border" id="hire-form">
                    <h3 class="h5 fw-bold mb-3" style="color:#003c70">درخواست همکاری</h3>
                    <form method="post" action="" novalidate>
                        {% csrf_token %}
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label small">نام شرکت</label>
                                <input name="name" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">ایمیل</label>
                                <input name="email" type="email" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">شماره تماس</label>
                                <input name="phone" class="form-control" placeholder="مثلاً 09120000000">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">نقش/عنوان موردنظر</label>
                                <input name="role" class="form-control" placeholder="Full-Stack / Android / Django">
                            </div>
                            <div class="col-12">
                                <label class="form-label small">نوع همکاری</label>
                                <select name="mode" class="form-select">
                                    <option>تمام‌وقت</option>
                                    <option>پاره‌وقت</option>
                                    <option>پروژه‌ای</option>
                                    <option>دورکاری</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">مهارت‌های کلیدی مورد انتظار</label>
                                <input name="skills" class="form-control"
                                       placeholder="Django, DRF, Android, Bootstrap, Docker">
                            </div>
                            <div class="col-12">
                                <label class="form-label small">پیام/توضیحات</label>
                                <textarea name="message" rows="4" class="form-control"></textarea>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-outline-primary rounded-3 px-4">ارسال درخواست همکاری</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</section>

<script>
    // اسکرول نرم به فرم‌ها (در صورت نبودِ scroll-behavior CSS)
    document.querySelectorAll('a[href^="#"]').forEach(a => {
        a.addEventListener("click", (e) => {
            const id = a.getAttribute("href").slice(1);
            const el = document.getElementById(id);
            if (el) {
                e.preventDefault();
                el.scrollIntoView({behavior: "smooth", block: "start"});
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // هندل کردن هر دو فرم
        const forms = [
            {id: "project-form", url: "{% url 'collab:project' %}"},
            {id: "hire-form", url: "{% url 'collab:hire' %}"}
        ];

        forms.forEach(({id, url}) => {
            const formCard = document.getElementById(id);
            if (!formCard) return;

            const form = formCard.querySelector("form");
            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const submitBtn = form.querySelector("button");
                const originalText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = "در حال ارسال...";

                const formData = new FormData(form);

                try {
                    const response = await fetch(url, {
                        method: "POST",
                        headers: {
                            "X-CSRFToken": form.querySelector("[name=csrfmiddlewaretoken]").value,
                        },
                        body: formData,
                    });

                    if (!response.ok) throw new Error("خطا در ارسال فرم");

                    // فرض بر اینه که ویو با redirect برمی‌گرده → پس JSON نمی‌فرسته
                    // برای همین چک می‌کنیم اگر redirect شد:
                    if (response.redirected) {
                        window.location.href = response.url;
                        return;
                    }

                    // در غیر این صورت نمایش پیام موفقیت
                    form.reset();
                    showAlert(formCard, "✅ فرم با موفقیت ارسال شد!", "success");
                } catch (error) {
                    showAlert(formCard, "❌ خطایی رخ داد. لطفاً دوباره تلاش کنید.", "danger");
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            });
        });

        // تابع نمایش پیام بالا فرم
        function showAlert(container, message, type = "info") {
            const alert = document.createElement("div");
            alert.className = `alert alert-${type} mt-3 rounded-3`;
            alert.innerText = message;
            container.appendChild(alert);
            setTimeout(() => alert.remove(), 4000);
        }
    });
</script>

{% endblock %}
