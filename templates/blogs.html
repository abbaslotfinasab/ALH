{% extends "base.html" %}
{% load static %}

{% block extra_head %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ seo_title|escapejs }}",
  "description": "{{ seo_description|escapejs }}",
  "url": "{{ canonical_url|default:request.build_absolute_uri }}",
  "hasPart": [
    {% for post in blog_post %}
    {
      "@type": "BlogPosting",
      "headline": "{{ post.title|escapejs }}",
      "url": "{{ request.build_absolute_uri }}{{ post.get_absolute_url }}",
      "datePublished": "{{ post.published_date|date:'Y-m-d' }}",
      "description": "{{ post.meta_description|default:post.content|truncatechars:160|escapejs }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ],
  "publisher": {
    "@type": "Organization",
    "name": "abbaslotfinasab.ir",
    "logo": {
      "@type": "ImageObject",
      "url": "{% static 'images/logo.png' %}"
    }
  }
}
</script>

{% endblock %}

{% block content %}


<section class="feed-section py-5">
    <div class="container">
        <!-- Search Header -->
        <div class="feed-search bg-transparent">
            <div class="search-wrap shadow-sm rounded-4 p-2 p-md-3">
                <form class="row g-2 align-items-center" role="search" onsubmit="return false;">
                    <!-- سرچ -->
                    <div class="col-12 col-md">
                        <div class="search-input d-flex align-items-center gap-2 px-3 py-2 rounded-3">
                            <i class="fa-solid fa-magnifying-glass search-ico"></i>
                            <input id="qInput" type="search" inputmode="search" autocomplete="off"
                                   class="form-control border-0 bg-transparent"
                                   placeholder="جستجو بین عنوان و متن پژوهش ها…">
                            <button id="clearSearch" class="btn btn-clear d-none" type="button"
                                    aria-label="پاک کردن جستجو">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                    </div>

                    <!-- تاریخ -->
                    <div class="col-6 col-md-auto">
                        <div class="date-chip d-flex align-items-center gap-2 px-3 py-2 rounded-3">
                            <i class="fa-regular fa-calendar"></i>
                            <input id="dateInput" type="date"
                                   class="form-control form-control-sm border-0 bg-transparent">
                            <button id="clearDate" class="btn btn-clear" type="button" aria-label="پاک کردن تاریخ">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                    </div>

                </form>

            </div>
        </div>

        <div class="row g-4">
            {% for post in blog_post %}
            <div class="col-md-6 col-lg-4">
                <article class="card h-100 shadow-sm border-0">
                    {% if post.cover %}
                    <img src="{{ post.cover.url }}" class="card-img-top" alt="{{ post.title }}">
                    {% else %}
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center"
                         style="height:180px;">
                        <i data-lucide="file-text" class="fs-1 text-secondary"></i>
                    </div>
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><a href="{{ post.get_absolute_url }}" class="text-dark">{{ post.title
                            }}</a></h5>
                        <p class="card-text text-muted small">{{ post.excerpt|truncatewords:25 }}</p>
                        <div class="mt-auto d-flex justify-content-between align-items-center pt-3">
                            <div class="d-flex gap-2 align-items-center text-muted small">
                                <div class="metric-pill d-flex align-items-center gap-1 px-2 py-1 rounded-pill bg-light">
                                    <i data-lucide="eye" class="me-1"></i> <span>{{ post.views }}</span>
                                </div>
                                <div class="metric-pill d-flex align-items-center gap-1 px-2 py-1 rounded-pill bg-light">
                                    <i data-lucide="heart" class="me-1"></i> <span>{{ post.likes }}</span>
                                </div>
                            </div>
                            <a href="{{ post.get_absolute_url }}" class="btn btn-sm btn-primary">خواندن</a>
                        </div>
                    </div>
                </article>
            </div>
            {% endfor %}
        </div>

        <div class="mt-4">
            {% if is_paginated %}
            <nav aria-label="Pagination">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                    <li class="page-item"><a class="page-link"
                                             href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{request.GET.q}}{% endif %}">قبلی</a>
                    </li>
                    {% endif %}
                    <li class="page-item disabled"><span class="page-link">صفحه {{ page_obj.number }} از {{ page_obj.paginator.num_pages }}</span>
                    </li>
                    {% if page_obj.has_next %}
                    <li class="page-item"><a class="page-link"
                                             href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{request.GET.q}}{% endif %}">بعدی</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
